{"version":3,"file":"calendarBase.js","names":["useTimes","computeColor","provideLocale","computed","createDayList","createNativeLocaleFormatter","getEndOfMonth","getEndOfWeek","getStartOfMonth","getStartOfWeek","getTimestampIdentifier","getWeekdaySkips","parseDate","parseTimestamp","validateTimestamp","validateWeekdays","propsFactory","makeCalendarBaseProps","start","type","String","Number","Date","validate","default","date","end","weekdays","Array","weekdayFormat","Function","dayFormat","locale","now","validator","useCalendarBase","props","times","parsedWeekdays","isArray","split","map","x","parseInt","weekdaySkips","value","parsedStart","parsedEnd","days","today","dayFormatter","current","timeZone","day","weekdayFormatter","_tms","short","weekday","getColorProps","colors","getRelativeClasses","timestamp","outside","arguments","length","undefined","present","past","future","_getStartOfWeek","_getEndOfWeek","getFormatter","options"],"sources":["../../../../src/labs/VCalendar/composables/calendarBase.ts"],"sourcesContent":["// Composables\nimport { useTimes } from './times'\nimport { computeColor } from '@/composables/color'\nimport { provideLocale } from '@/composables/locale'\n\n// Utilities\nimport { computed } from 'vue'\nimport {\n  createDayList,\n  createNativeLocaleFormatter, getEndOfMonth,\n  getEndOfWeek, getStartOfMonth,\n  getStartOfWeek,\n  getTimestampIdentifier,\n  getWeekdaySkips,\n  parseDate,\n  parseTimestamp,\n  validateTimestamp,\n  validateWeekdays,\n} from '../util/timestamp'\nimport { propsFactory } from '@/util'\n\n// Types\nimport type { PropType } from 'vue'\nimport type { CalendarFormatter, CalendarTimestamp } from '../types'\nimport type { ColorValue } from '@/composables/color'\n\nexport const makeCalendarBaseProps = propsFactory({\n  start: {\n    type: [String, Number, Date],\n    validate: validateTimestamp,\n    default: () => parseDate(new Date()).date,\n  },\n  end: {\n    type: [String, Number, Date],\n    validate: validateTimestamp,\n  },\n  weekdays: {\n    type: [Array, String] as PropType<number[] | string>,\n    default: () => [0, 1, 2, 3, 4, 5, 6],\n    validate: validateWeekdays,\n  },\n  weekdayFormat: {\n    type: Function as PropType<CalendarFormatter>,\n    default: null,\n  },\n  dayFormat: {\n    type: Function as PropType<CalendarFormatter>,\n    default: null,\n  },\n  locale: String,\n  now: {\n    type: String,\n    validator: validateTimestamp,\n  },\n  type: {\n    type: String as PropType<'month' | 'week' | 'day' | '4day' | 'custom-weekly' | 'custom-daily' | 'category'>,\n    default: 'month',\n  },\n}, 'VCalendar-base')\n\nexport interface CalendarBaseProps {\n  start: string | number | Date\n  end: string | number | Date | undefined\n  weekdays: string | number[]\n  weekdayFormat: CalendarFormatter | string | undefined\n  dayFormat: CalendarFormatter | string | undefined\n  locale: string | undefined\n  now: string | undefined\n  type: 'month' | 'week' | 'day' | '4day' | 'custom-weekly' | 'custom-daily' | 'category'\n}\n\nexport function useCalendarBase (props: CalendarBaseProps) {\n  const { times } = useTimes({ now: props.now })\n  const locale = provideLocale(props)\n\n  const parsedWeekdays = computed((): number[] => {\n    return Array.isArray(props.weekdays)\n      ? props.weekdays\n      : (props.weekdays || '').split(',').map(x => parseInt(x, 10))\n  })\n\n  const weekdaySkips = computed((): number[] => {\n    return getWeekdaySkips(parsedWeekdays.value)\n  })\n\n  const parsedStart = computed((): CalendarTimestamp => {\n    if (props.type === 'month') {\n      return getStartOfMonth(parseTimestamp(props.start, true))\n    }\n    return parseTimestamp(props.start, true)\n  })\n\n  const parsedEnd = computed((): CalendarTimestamp => {\n    const start = parsedStart.value\n    const end: CalendarTimestamp = props.end ? parseTimestamp(props.end) || start : start\n    const value = getTimestampIdentifier(end) < getTimestampIdentifier(start) ? start : end\n\n    if (props.type === 'month') {\n      return getEndOfMonth(value)\n    }\n    return value\n  })\n\n  const days = computed((): CalendarTimestamp[] => {\n    return createDayList(\n      parsedStart.value,\n      parsedEnd.value,\n      times.today,\n      weekdaySkips.value,\n    )\n  })\n\n  const dayFormatter = computed((): CalendarFormatter => {\n    if (props.dayFormat) {\n      return props.dayFormat as CalendarFormatter\n    }\n\n    return createNativeLocaleFormatter(\n      locale.current.value,\n      () => ({ timeZone: 'UTC', day: 'numeric' })\n    )\n  })\n\n  const weekdayFormatter = computed((): CalendarFormatter => {\n    if (props.weekdayFormat) {\n      return props.weekdayFormat as CalendarFormatter\n    }\n\n    return createNativeLocaleFormatter(\n      locale.current.value,\n      (_tms, short) => ({ timeZone: 'UTC', weekday: short ? 'short' : 'long' })\n    )\n  })\n\n  function getColorProps (colors: { background?: ColorValue, text?: ColorValue }) {\n    return computeColor(colors)\n  }\n\n  function getRelativeClasses (timestamp: CalendarTimestamp, outside = false) {\n    return {\n      'v-present': timestamp.present,\n      'v-past': timestamp.past,\n      'v-future': timestamp.future,\n      'v-outside': outside,\n    }\n  }\n\n  function _getStartOfWeek (timestamp: CalendarTimestamp): CalendarTimestamp {\n    return getStartOfWeek(timestamp, parsedWeekdays.value, times.today)\n  }\n\n  function _getEndOfWeek (timestamp: CalendarTimestamp): CalendarTimestamp {\n    return getEndOfWeek(timestamp, parsedWeekdays.value, times.today)\n  }\n\n  function getFormatter (options: Intl.DateTimeFormatOptions): CalendarFormatter {\n    return createNativeLocaleFormatter(locale.current.value, () => options)\n  }\n\n  return {\n    times,\n    locale,\n    parsedWeekdays,\n    weekdaySkips,\n    parsedStart,\n    parsedEnd,\n    days,\n    dayFormatter,\n    weekdayFormatter,\n    getColorProps,\n    getRelativeClasses,\n    getStartOfWeek: _getStartOfWeek,\n    getEndOfWeek: _getEndOfWeek,\n    getFormatter,\n  }\n}\n"],"mappings":"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","ignoreList":[]}